import mongoose from 'mongoose';

let isConnected = false; // Track connection status

export const connectToDatabase = async () => {
  if (isConnected) {
    console.log('=> using existing database connection');
    return mongoose.connection; // Return the existing connection
  }

  try {
    // Establish a new connection
    await mongoose.connect(process.env.MONGODB_URI, {
      dbName: 'share-prompt',
    });

    isConnected = true;
    console.log('=> database connected successfully');

    return mongoose.connection; // Return the new connection
  } catch (error) {
    console.error('Error connecting to the database:', error);
    throw new Error('Database connection failed');
  }
};
